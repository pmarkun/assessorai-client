{% extends 'base.html' %}
{% load static %}

{% block title %}Gestão de Equipe - AssessorAI{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto space-y-8" x-data="sugestoes()">
  <h1 class="text-3xl font-bold text-gray-800">Gestão de Equipe</h1>

  {% include 'core/partials/member_list.html' with membros=membros %}

  <div class="bg-white p-4 rounded shadow">
    <form id="form-convite" method="post" hx-post="{% url 'core:invite_member' %}" hx-target="#lista-membros" hx-swap="outerHTML" hx-on:after-request="this.reset()">
      {% csrf_token %}
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>{{ form.nome.label_tag }}{{ form.nome }}</div>
        <div>{{ form.email.label_tag }}{{ form.email }}</div>
        <div>{{ form.funcao.label_tag }}{{ form.funcao }}</div>
      </div>
      <button type="submit" class="mt-4 bg-purple-600 text-white px-4 py-2 rounded">Convidar</button>
    </form>
  </div>

  <div class="bg-white p-4 rounded shadow space-y-4">
    <h2 class="text-xl font-semibold">Sugestões com IA</h2>
    <div>
      <label for="num-cargos" class="block text-sm font-medium">Quantidade de cargos</label>
      <input type="number" id="num-cargos" x-ref="numCargos" class="border rounded px-2 py-1">
      <button @click.prevent="gerarCargos" class="ml-2 bg-blue-600 text-white px-3 py-1 rounded">Gerar</button>
      <pre class="mt-2 text-sm whitespace-pre-wrap" x-text="cargos"></pre>
    </div>
    <div>
      <label for="cargo-nome" class="block text-sm font-medium">Cargo existente</label>
      <input type="text" id="cargo-nome" x-ref="cargoNome" class="border rounded px-2 py-1">
      <button @click.prevent="gerarAtividades" class="ml-2 bg-blue-600 text-white px-3 py-1 rounded">Sugerir</button>
      <pre class="mt-2 text-sm whitespace-pre-wrap" x-text="atividades"></pre>
    </div>
  </div>
</div>
<script>
document.addEventListener('alpine:init', () => {
  Alpine.data('sugestoes', () => ({
    cargos: '',
    atividades: '',
    gerarCargos() {
      fetch('/api/ai/sugestoes/', {
        method: 'POST',
        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
        body: new URLSearchParams({ tipo: 'cargos', quantidade: this.$refs.numCargos.value })
      }).then(r => r.json()).then(d => { this.cargos = d.sugestao })
    },
    gerarAtividades() {
      fetch('/api/ai/sugestoes/', {
        method: 'POST',
        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
        body: new URLSearchParams({ tipo: 'atividades', cargo: this.$refs.cargoNome.value })
      }).then(r => r.json()).then(d => { this.atividades = d.sugestao })
    }
  }))
})
</script>
{% endblock %}
